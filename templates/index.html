<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
    <style>
        .chart-container { position: relative; height: 400px; }
        .tooltip {
            position: absolute;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            padding: 10px 12px;
            border-radius: 6px;
            font-size: 13px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
            backdrop-filter: blur(4px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .signal-buy { 
            animation: pulse-green 2s infinite;
            box-shadow: 0 4px 14px rgba(16, 185, 129, 0.3);
        }
        .signal-sell { 
            animation: pulse-red 2s infinite;
            box-shadow: 0 4px 14px rgba(239, 68, 68, 0.3);
        }
        @keyframes pulse-green {
            0% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.4); }
            70% { box-shadow: 0 0 0 12px rgba(16, 185, 129, 0); }
            100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); }
        }
        @keyframes pulse-red {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.4); }
            70% { box-shadow: 0 0 0 12px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }
        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
            transition: all 0.2s ease;
        }
        .card:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            transform: translateY(-2px);
        }
        .control-btn {
            transition: all 0.2s ease;
            box-shadow: 0 1px 2px rgba(0, 0, 0, 0.05);
        }
        .control-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
    </style>
</head>
<body class="bg-gray-50 font-sans">
    <div class="container mx-auto p-6 max-w-7xl">
        <!-- Header -->
        <div class="flex flex-col md:flex-row justify-between items-start md:items-center mb-8 gap-4">
            <div>
                <h1 class="text-3xl font-bold text-gray-900">Trading Dashboard</h1>
                <p class="text-gray-500 mt-1">Real-time market analysis and signals</p>
            </div>
            <div class="flex flex-col sm:flex-row gap-3 w-full md:w-auto">
                <select id="symbol-select" class="border border-gray-200 rounded-lg px-4 py-2 bg-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                    <option value="BTCUSDT">BTC/USDT</option>
                    <option value="ETHUSDT">ETH/USDT</option>
                    <option value="SOLUSDT">SOL/USDT</option>
                    <option value="XRPUSDT">XRP/USDT</option>
                </select>
                <select id="timeframe-select" class="border border-gray-200 rounded-lg px-4 py-2 bg-white focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500">
                    <option value="1h">1H</option>
                    <option value="4h">4H</option>
                    <option value="1d">1D</option>
                    <option value="1w">1W</option>
                </select>
                <button id="refresh-btn" class="bg-indigo-600 text-white px-4 py-2 rounded-lg control-btn hover:bg-indigo-700 flex items-center justify-center">
                    <i class="fas fa-sync-alt mr-2"></i> Refresh
                </button>
            </div>
        </div>

        <!-- Main Dashboard -->
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Left Column: Signal and Price -->
            <div class="lg:col-span-1 space-y-6">
                <!-- Current Signal -->
                <div class="card p-6">
                    <h2 class="text-xl font-semibold mb-4 text-gray-800">Current Signal</h2>
                    <div id="signal-indicator" class="text-4xl font-bold mb-3 px-8 py-4 rounded-full bg-gray-50 text-gray-800 flex items-center justify-center">
                        <i class="fas fa-pause mr-3"></i> HOLD
                    </div>
                    <p id="signal-confidence" class="text-lg">Confidence: <span class="font-medium">-</span></p>
                    <p id="signal-strategy" class="text-lg">Strategy: <span class="font-medium">-</span></p>
                    <p id="signal-timestamp" class="text-sm text-gray-500">-</p>
                </div>

                <!-- Price Information -->
                <div class="card p-6">
                    <h2 class="text-xl font-semibold mb-4 text-gray-800">Price Information</h2>
                    <p class="text-lg">Current Price: <span id="current-price" class="font-medium">-</span></p>
                    <p class="text-lg">24h Change: <span id="price-change" class="font-medium">-</span></p>
                    <p class="text-lg">24h Volume: <span id="volume" class="font-medium">-</span></p>
                    <p class="text-lg">ATR: <span id="atr" class="font-medium">-</span></p>
                </div>

                <!-- Position Management -->
                <div class="card p-6">
                    <h2 class="text-xl font-semibold mb-4 text-gray-800">Position Management</h2>
                    <p class="text-lg">Current Position: <span id="current-position" class="font-medium">-</span></p>
                    <p class="text-lg">Entry Price: <span id="entry-price" class="font-medium">-</span></p>
                    <p class="text-lg">Quantity: <span id="position-qty" class="font-medium">-</span></p>
                    <p class="text-lg">Unrealized PnL: <span id="position-pnl" class="font-medium">-</span></p>
                    <div class="flex space-x-4 mt-4">
                        <button id="close-position-btn" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600" disabled>Close Position</button>
                        <button id="adjust-position-btn" class="bg-gray-200 text-gray-800 px-4 py-2 rounded hover:bg-gray-300" disabled>Adjust Position</button>
                    </div>
                </div>
            </div>

            <!-- Right Column: Charts and Indicators -->
            <div class="lg:col-span-2 space-y-6">
                <!-- Price Chart -->
                <div class="card p-6">
                    <h2 class="text-xl font-semibold mb-4 text-gray-800">Price & Volume</h2>
                    <div class="chart-container">
                        <canvas id="price-chart"></canvas>
                        <div class="tooltip"></div>
                    </div>
                </div>

                <!-- Indicators -->
                <div class="card p-6">
                    <h2 class="text-xl font-semibold mb-4 text-gray-800">Indicators</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <!-- RSI -->
                        <div>
                            <p class="text-lg">RSI: <span id="rsi-value" class="font-medium">-</span></p>
                            <div class="w-full bg-gray-200 rounded h-2 mt-2">
                                <div id="rsi-gauge" class="bg-green-500 h-2 rounded" style="width: 0%"></div>
                            </div>
                            <p id="rsi-interpretation" class="text-sm mt-2 text-gray-600">-</p>
                        </div>
                        <!-- MACD -->
                        <div>
                            <p class="text-lg">MACD: <span id="macd-value" class="font-medium">-</span> <span id="macd-direction"></span></p>
                            <p class="text-sm">Signal: <span id="macd-signal">-</span>, Histogram: <span id="macd-hist">-</span></p>
                            <p id="macd-interpretation" class="text-sm mt-2 text-gray-600">-</p>
                        </div>
                        <!-- ADX -->
                        <div>
                            <p class="text-lg">ADX: <span id="adx-value" class="font-medium">-</span></p>
                            <div class="w-full bg-gray-200 rounded h-2 mt-2">
                                <div id="adx-gauge" class="bg-purple-500 h-2 rounded" style="width: 0%"></div>
                            </div>
                            <p id="adx-interpretation" class="text-sm mt-2 text-gray-600">-</p>
                        </div>
                        <!-- EMA Crossover -->
                        <div>
                            <p class="text-lg">EMA Crossover: <span id="ema-crossover-value" class="font-semibold">-</span> <span id="ema-direction"></span></p>
                            <p class="text-sm">EMA20: <span id="ema20-value">-</span>, EMA50: <span id="ema50-value">-</span></p>
                            <p id="ema-interpretation" class="text-sm mt-2 text-gray-600">-</p>
                        </div>
                        <!-- ROC -->
                        <div>
                            <p class="text-lg">ROC: <span id="roc-value" class="font-medium">-</span> <span id="roc-direction"></span></p>
                            <div class="w-full bg-gray-200 rounded h-2 mt-2">
                                <div id="roc-gauge" class="bg-blue-500 h-2 rounded" style="width: 50%"></div>
                            </div>
                            <p id="roc-interpretation" class="text-sm mt-2 text-gray-600">-</p>
                        </div>
                        <!-- LSTM Prediction -->
                        <div>
                            <p class="text-lg">LSTM Prediction: <span id="lstm-value" class="font-medium">-</span></p>
                            <div class="w-full bg-gray-200 rounded h-2 mt-2">
                                <div id="lstm-gauge" class="bg-yellow-500 h-2 rounded" style="width: 50%"></div>
                            </div>
                            <p id="lstm-interpretation" class="text-sm mt-2 text-gray-600">-</p>
                        </div>
                    </div>
                    <!-- Indicators Chart -->
                    <div class="mt-6">
                        <div class="flex space-x-2 mb-4">
                            <button class="bg-indigo-600 text-white px-3 py-1 rounded text-sm">ADX</button>
                            <button class="bg-gray-200 hover:bg-gray-300 px-3 py-1 rounded text-sm">RSI</button>
                            <button class="bg-gray-200 hover:bg-gray-300 px-3 py-1 rounded text-sm">MACD</button>
                            <button class="bg-gray-200 hover:bg-gray-300 px-3 py-1 rounded text-sm">MACD Signal</button>
                        </div>
                        <div class="chart-container">
                            <canvas id="indicators-chart"></canvas>
                            <div class="tooltip"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Signal History -->
        <div class="card p-6 mt-8">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-semibold text-gray-800">Signal History</h2>
                <button class="text-indigo-600 hover:text-indigo-800 text-sm font-medium">View All</button>
            </div>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Time</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Symbol</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Signal</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Price</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Confidence</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Strategy</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Result</th>
                        </tr>
                    </thead>
                    <tbody id="signal-history" class="bg-white divide-y divide-gray-200"></tbody>
                </table>
            </div>
            <div class="flex justify-between items-center mt-4">
                <p class="text-sm text-gray-600">
                    Showing <span id="history-start">0</span> to <span id="history-end">0</span> of <span id="history-total">0</span> entries
                </p>
                <div class="flex space-x-2">
                    <button class="bg-gray-200 hover:bg-gray-300 px-3 py-1 rounded text-sm">Previous</button>
                    <button class="bg-gray-200 hover:bg-gray-300 px-3 py-1 rounded text-sm">Next</button>
                </div>
            </div>
        </div>

        <!-- Trade History -->
        <div class="card p-6 mt-8">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-semibold text-gray-800">Trade History</h2>
                <button class="text-indigo-600 hover:text-indigo-800 text-sm font-medium">View All</button>
            </div>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Time</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Symbol</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Side</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Quantity</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Entry Price</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Exit Price</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">PnL</th>
                        </tr>
                    </thead>
                    <tbody id="trade-history" class="bg-white divide-y divide-gray-200"></tbody>
                </table>
            </div>
            <div class="flex justify-between items-center mt-4">
                <p class="text-sm text-gray-600">
                    Showing <span id="trade-history-start">0</span> to <span id="trade-history-end">0</span> of <span id="trade-history-total">0</span> entries
                </p>
                <div class="flex space-x-2">
                    <button class="bg-gray-200 hover:bg-gray-300 px-3 py-1 rounded text-sm">Previous</button>
                    <button class="bg-gray-200 hover:bg-gray-300 px-3 py-1 rounded text-sm">Next</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/socket.io-client@4.5.0/dist/socket.io.min.js"></script>
    <script>
        let priceChart, indicatorsChart;
        const socket = io.connect("http://localhost:5000");

        socket.on("connect", () => {
            console.log("Connected to WebSocket server");
            requestData();
        });

        socket.on("initial_data", (data) => {
            updateDashboard(data);
        });

        socket.on("update", (data) => {
            updateDashboard(data);
        });

        socket.on("error", (data) => {
            showNotification(`Error: ${data.message}`, "error");
        });

        function requestData() {
            const symbol = document.getElementById("symbol-select").value;
            socket.emit("request_data", { symbol });
        }

        function updateDashboard(data) {
            const symbol = document.getElementById("symbol-select").value;
            // Current Signal
            const currentSignal = data.currentSignal || {
                action: "hold",
                confidence: 0,
                strategy: "none",
                timestamp: new Date().toISOString()
            };
            const signalEl = document.getElementById("signal-indicator");
            signalEl.className = "text-4xl font-bold mb-3 px-8 py-4 rounded-full";
            if (currentSignal.action.toLowerCase() === "buy") {
                signalEl.classList.add("bg-green-100", "text-green-800", "signal-buy");
                signalEl.innerHTML = '<i class="fas fa-arrow-up mr-2"></i> BUY';
            } else if (currentSignal.action.toLowerCase() === "sell") {
                signalEl.classList.add("bg-red-100", "text-red-800", "signal-sell");
                signalEl.innerHTML = '<i class="fas fa-arrow-down mr-2"></i> SELL';
            } else {
                signalEl.classList.add("bg-gray-100", "text-gray-800");
                signalEl.innerHTML = '<i class="fas fa-pause mr-2"></i> HOLD';
            }
            document.getElementById("signal-confidence").innerHTML = `Confidence: <span class="font-medium">${Math.round(currentSignal.confidence * 100)}%</span>`;
            document.getElementById("signal-strategy").innerHTML = `Strategy: <span class="font-medium">${currentSignal.strategy}</span>`;
            document.getElementById("signal-timestamp").textContent = new Date(currentSignal.timestamp).toLocaleString();

            // Price Information
            const priceInfo = data.priceInfo || { current: 0, change: 0, changePercent: 0, volume: 0, atr: 0 };
            document.getElementById("current-price").textContent = `$${priceInfo.current.toLocaleString(undefined, { minimumFractionDigits: 2, maximumFractionDigits: 2 })}`;
            const changeEl = document.getElementById("price-change");
            if (priceInfo.changePercent >= 0) {
                changeEl.className = "font-medium text-green-600";
                changeEl.innerHTML = `+${priceInfo.changePercent.toFixed(2)}% <i class="fas fa-arrow-up"></i>`;
            } else {
                changeEl.className = "font-medium text-red-600";
                changeEl.innerHTML = `${priceInfo.changePercent.toFixed(2)}% <i class="fas fa-arrow-down"></i>`;
            }
            document.getElementById("volume").textContent = priceInfo.volume ? priceInfo.volume.toFixed(2) : "-";
            document.getElementById("atr").textContent = priceInfo.atr ? priceInfo.atr.toFixed(2) : "-";

            // Position Management
            const position = data.position || {
                type: "none",
                entryPrice: 0,
                quantity: 0,
                pnl: 0,
                pnlPercent: 0
            };
            const positionEl = document.getElementById("current-position");
            positionEl.textContent = position.type.charAt(0).toUpperCase() + position.type.slice(1);
            positionEl.className = position.type === "buy" ? "font-medium text-green-600" : position.type === "sell" ? "font-medium text-red-600" : "font-medium";
            document.getElementById("entry-price").textContent = position.entryPrice ? `$${position.entryPrice.toFixed(2)}` : "-";
            document.getElementById("position-qty").textContent = position.quantity || "-";
            const pnlEl = document.getElementById("position-pnl");
            pnlEl.textContent = position.pnl ? `$${position.pnl.toFixed(2)} (${position.pnlPercent.toFixed(2)}%)` : "-";
            pnlEl.className = position.pnl >= 0 ? "font-medium text-green-600" : "font-medium text-red-600";
            document.getElementById("close-position-btn").disabled = position.type === "none";
            document.getElementById("adjust-position-btn").disabled = position.type === "none";

            // Indicators
            const indicators = data.indicators || {};
            // RSI
            document.getElementById("rsi-value").textContent = indicators.rsi ? indicators.rsi.toFixed(2) : "-";
            document.getElementById("rsi-gauge").style.width = indicators.rsi ? `${indicators.rsi}%` : "0%";
            let rsiInterpretation = "";
            if (indicators.rsi > 70) {
                rsiInterpretation = "Overbought";
                document.getElementById("rsi-interpretation").className = "text-sm mt-2 text-red-600";
            } else if (indicators.rsi < 30) {
                rsiInterpretation = "Oversold";
                document.getElementById("rsi-interpretation").className = "text-sm mt-2 text-green-600";
            } else {
                rsiInterpretation = "Neutral";
                document.getElementById("rsi-interpretation").className = "text-sm mt-2 text-gray-600";
            }
            document.getElementById("rsi-interpretation").textContent = rsiInterpretation;

            // MACD
            document.getElementById("macd-value").textContent = indicators.macd ? indicators.macd.toFixed(4) : "-";
            document.getElementById("macd-signal").textContent = indicators.macdSignal ? indicators.macdSignal.toFixed(4) : "-";
            document.getElementById("macd-hist").textContent = indicators.macdHist ? indicators.macdHist.toFixed(4) : "-";
            const macdDirectionEl = document.getElementById("macd-direction");
            macdDirectionEl.innerHTML = "";
            if (indicators.macd && indicators.macdSignal && indicators.macd > indicators.macdSignal) {
                macdDirectionEl.innerHTML = '<i class="fas fa-arrow-up text-green-600"></i>';
                document.getElementById("macd-interpretation").textContent = "Bullish";
                document.getElementById("macd-interpretation").className = "text-sm mt-2 text-green-600";
            } else if (indicators.macd && indicators.macdSignal && indicators.macd < indicators.macdSignal) {
                macdDirectionEl.innerHTML = '<i class="fas fa-arrow-down text-red-600"></i>';
                document.getElementById("macd-interpretation").textContent = "Bearish";
                document.getElementById("macd-interpretation").className = "text-sm mt-2 text-red-600";
            } else {
                macdDirectionEl.innerHTML = '<i class="fas fa-equals text-gray-400"></i>';
                document.getElementById("macd-interpretation").textContent = "Neutral";
                document.getElementById("macd-interpretation").className = "text-sm mt-2 text-gray-600";
            }

            // ADX
            document.getElementById("adx-value").textContent = indicators.adx ? indicators.adx.toFixed(2) : "-";
            document.getElementById("adx-gauge").style.width = indicators.adx ? `${indicators.adx}%` : "0%";
            let adxInterpretation = "";
            if (indicators.adx > 50) {
                adxInterpretation = "Very strong trend";
                document.getElementById("adx-interpretation").className = "text-sm mt-2 text-purple-600";
            } else if (indicators.adx > 25) {
                adxInterpretation = "Strong trend";
                document.getElementById("adx-interpretation").className = "text-sm mt-2 text-purple-500";
            } else {
                adxInterpretation = "Weak or no trend";
                document.getElementById("adx-interpretation").className = "text-sm mt-2 text-gray-600";
            }
            document.getElementById("adx-interpretation").textContent = adxInterpretation;

            // EMA Crossover
            document.getElementById("ema20-value").textContent = indicators.ema20 ? indicators.ema20.toFixed(2) : "-";
            document.getElementById("ema50-value").textContent = indicators.ema50 ? indicators.ema50.toFixed(2) : "-";
            const emaDirectionEl = document.getElementById("ema-direction");
            emaDirectionEl.innerHTML = "";
            if (indicators.ema20 && indicators.ema50 && indicators.ema20 > indicators.ema50) {
                emaDirectionEl.innerHTML = '<i class="fas fa-arrow-up text-green-600"></i>';
                document.getElementById("ema-crossover-value").textContent = "Bullish";
                document.getElementById("ema-crossover-value").className = "text-lg font-semibold text-green-600";
                document.getElementById("ema-interpretation").textContent = "EMA20 above EMA50 - Bullish trend";
                document.getElementById("ema-interpretation").className = "text-sm mt-2 text-green-600";
            } else if (indicators.ema20 && indicators.ema50) {
                emaDirectionEl.innerHTML = '<i class="fas fa-arrow-down text-red-600"></i>';
                document.getElementById("ema-crossover-value").textContent = "Bearish";
                document.getElementById("ema-crossover-value").className = "text-lg font-semibold text-red-600";
                document.getElementById("ema-interpretation").textContent = "EMA20 below EMA50 - Bearish trend";
                document.getElementById("ema-interpretation").className = "text-sm mt-2 text-red-600";
            } else {
                document.getElementById("ema-crossover-value").textContent = "-";
                document.getElementById("ema-interpretation").textContent = "No data";
                document.getElementById("ema-interpretation").className = "text-sm mt-2 text-gray-600";
            }

            // ROC
            document.getElementById("roc-value").textContent = indicators.roc ? `${indicators.roc.toFixed(2)}%` : "-";
            document.getElementById("roc-gauge").style.width = indicators.roc ? `${(indicators.roc + 5) * 10}%` : "50%";
            const rocDirectionEl = document.getElementById("roc-direction");
            rocDirectionEl.innerHTML = "";
            if (indicators.roc && indicators.roc > 0) {
                rocDirectionEl.innerHTML = '<i class="fas fa-arrow-up text-green-600"></i>';
                document.getElementById("roc-interpretation").textContent = "Positive momentum";
                document.getElementById("roc-interpretation").className = "text-sm mt-2 text-green-600";
            } else if (indicators.roc) {
                rocDirectionEl.innerHTML = '<i class="fas fa-arrow-down text-red-600"></i>';
                document.getElementById("roc-interpretation").textContent = "Negative momentum";
                document.getElementById("roc-interpretation").className = "text-sm mt-2 text-red-600";
            } else {
                rocDirectionEl.innerHTML = '<i class="fas fa-arrows-alt-v text-gray-400"></i>';
                document.getElementById("roc-interpretation").textContent = "No data";
                document.getElementById("roc-interpretation").className = "text-sm mt-2 text-gray-600";
            }

            // LSTM Prediction
            document.getElementById("lstm-value").textContent = indicators.lstm ? indicators.lstm.toFixed(4) : "-";
            document.getElementById("lstm-gauge").style.width = indicators.lstm ? `${indicators.lstm * 100}%` : "50%";
            if (indicators.lstm && indicators.lstm > 0.6) {
                document.getElementById("lstm-interpretation").textContent = "Strong buy signal";
                document.getElementById("lstm-interpretation").className = "text-sm mt-2 text-green-600";
            } else if (indicators.lstm && indicators.lstm < 0.4) {
                document.getElementById("lstm-interpretation").textContent = "Strong sell signal";
                document.getElementById("lstm-interpretation").className = "text-sm mt-2 text-red-600";
            } else {
                document.getElementById("lstm-interpretation").textContent = "No data";
                document.getElementById("lstm-interpretation").className = "text-sm mt-2 text-gray-600";
            }

            // Update Charts
            updateCharts(data);

            // Populate Signal History
            populateSignalHistory(data.signalHistory.filter(s => s.symbol === symbol));

            // Populate Trade History
            populateTradeHistory(data.tradeHistory.filter(t => t.symbol === symbol));
        }

        function updateCharts(data) {
            const symbol = document.getElementById("symbol-select").value;
            const chartData = data.chartData || {
                labels: [],
                prices: [],
                volumes: [],
                rsi: [],
                macd: [],
                macdSignal: [],
                adx: []
            };

            if (!priceChart) {
                const priceCtx = document.getElementById("price-chart").getContext("2d");
                priceChart = new Chart(priceCtx, {
                    type: "line",
                    data: {
                        labels: chartData.labels,
                        datasets: [{
                            label: `${symbol} Price`,
                            data: chartData.prices,
                            borderColor: "rgba(79, 70, 229, 1)",
                            backgroundColor: "rgba(79, 70, 229, 0.1)",
                            borderWidth: 2,
                            fill: true,
                            tension: 0.1
                        }, {
                            label: "Volume",
                            data: chartData.volumes,
                            type: "bar",
                            backgroundColor: "rgba(16, 185, 129, 0.2)",
                            yAxisID: "y1"
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: true },
                            tooltip: {
                                enabled: false,
                                external: function(context) {
                                    const tooltip = document.querySelector(".chart-container .tooltip");
                                    if (context.tooltip.opacity === 0) {
                                        tooltip.style.opacity = 0;
                                        return;
                                    }
                                    const dataIndex = context.tooltip.dataPoints[0].dataIndex;
                                    const price = chartData.prices[dataIndex];
                                    const volume = chartData.volumes[dataIndex];
                                    tooltip.innerHTML = `
                                        <div class="font-semibold">${chartData.labels[dataIndex]}</div>
                                        <div>Price: $${price.toFixed(2)}</div>
                                        <div>Volume: ${volume.toFixed(2)}</div>
                                    `;
                                    tooltip.style.opacity = 1;
                                    tooltip.style.left = context.tooltip.x + "px";
                                    tooltip.style.top = context.tooltip.y + "px";
                                }
                            }
                        },
                        scales: {
                            x: { grid: { display: false } },
                            y: { beginAtZero: false, title: { display: true, text: "Price" } },
                            y1: {
                                type: "linear",
                                display: true,
                                position: "right",
                                grid: { drawOnChartArea: false },
                                title: { display: true, text: "Volume" }
                            }
                        }
                    }
                });
            } else {
                priceChart.data.labels = chartData.labels;
                priceChart.data.datasets[0].data = chartData.prices;
                priceChart.data.datasets[1].data = chartData.volumes;
                priceChart.update();
            }

            if (!indicatorsChart) {
                const indicatorsCtx = document.getElementById("indicators-chart").getContext("2d");
                indicatorsChart = new Chart(indicatorsCtx, {
                    type: "line",
                    data: {
                        labels: chartData.labels,
                        datasets: [
                            {
                                label: "ADX",
                                data: chartData.adx,
                                borderColor: "rgba(124, 58, 237, 1)",
                                backgroundColor: "rgba(124, 58, 237, 0.1)",
                                borderWidth: 2,
                                tension: 0.1,
                                yAxisID: "y"
                            },
                            {
                                label: "RSI",
                                data: chartData.rsi,
                                borderColor: "rgba(16, 185, 129, 1)",
                                backgroundColor: "rgba(16, 185, 129, 0.1)",
                                borderWidth: 2,
                                tension: 0.1,
                                yAxisID: "y1",
                                hidden: true
                            },
                            {
                                label: "MACD",
                                data: chartData.macd,
                                borderColor: "rgba(239, 68, 68, 1)",
                                backgroundColor: "rgba(239, 68, 68, 0.1)",
                                borderWidth: 2,
                                tension: 0.1,
                                yAxisID: "y2",
                                hidden: true
                            },
                            {
                                label: "MACD Signal",
                                data: chartData.macdSignal,
                                borderColor: "rgba(59, 130, 246, 1)",
                                backgroundColor: "rgba(59, 130, 246, 0.1)",
                                borderWidth: 2,
                                tension: 0.1,
                                yAxisID: "y2",
                                hidden: true
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { position: "top" },
                            tooltip: {
                                enabled: false,
                                external: function(context) {
                                    const tooltip = document.querySelector("#indicators-chart + .tooltip");
                                    if (context.tooltip.opacity === 0) {
                                        tooltip.style.opacity = 0;
                                        return;
                                    }
                                    const dataIndex = context.tooltip.dataPoints[0].dataIndex;
                                    const adx = chartData.adx[dataIndex];
                                    const rsi = chartData.rsi[dataIndex];
                                    const macd = chartData.macd[dataIndex];
                                    const macdSignal = chartData.macdSignal[dataIndex];
                                    tooltip.innerHTML = `
                                        <div class="font-semibold">${chartData.labels[dataIndex]}</div>
                                        <div>ADX: ${adx.toFixed(2)}</div>
                                        <div>RSI: ${rsi.toFixed(2)}</div>
                                        <div>MACD: ${macd.toFixed(4)}</div>
                                        <div>Signal: ${macdSignal.toFixed(4)}</div>
                                    `;
                                    tooltip.style.opacity = 1;
                                    tooltip.style.left = context.tooltip.x + "px";
                                    tooltip.style.top = context.tooltip.y + "px";
                                }
                            }
                        },
                        scales: {
                            x: { grid: { display: false } },
                            y: {
                                type: "linear",
                                display: true,
                                position: "left",
                                title: { display: true, text: "ADX" }
                            },
                            y1: {
                                type: "linear",
                                display: false,
                                position: "right",
                                min: 0,
                                max: 100,
                                grid: { drawOnChartArea: false },
                                title: { display: true, text: "RSI" }
                            },
                            y2: {
                                type: "linear",
                                display: false,
                                position: "right",
                                grid: { drawOnChartArea: false },
                                title: { display: true, text: "MACD" }
                            }
                        }
                    }
                });

                document.querySelectorAll("#indicators-chart + div button").forEach(btn => {
                    btn.addEventListener("click", function() {
                        document.querySelectorAll("#indicators-chart + div button").forEach(b => {
                            b.className = "bg-gray-200 hover:bg-gray-300 px-3 py-1 rounded text-sm";
                        });
                        this.className = "bg-indigo-600 text-white px-3 py-1 rounded text-sm";
                        const text = this.textContent.trim().toLowerCase();
                        indicatorsChart.data.datasets.forEach(ds => {
                            ds.hidden = (ds.label.toLowerCase() !== text);
                        });
                        indicatorsChart.options.scales.y.title.text = text.toUpperCase();
                        indicatorsChart.update();
                    });
                });
            } else {
                indicatorsChart.data.labels = chartData.labels;
                indicatorsChart.data.datasets[0].data = chartData.adx;
                indicatorsChart.data.datasets[1].data = chartData.rsi;
                indicatorsChart.data.datasets[2].data = chartData.macd;
                indicatorsChart.data.datasets[3].data = chartData.macdSignal;
                indicatorsChart.update();
            }
        }

        function populateSignalHistory(signals) {
            const tbody = document.getElementById("signal-history");
            tbody.innerHTML = "";
            signals.forEach(signal => {
                const tr = document.createElement("tr");
                // Time
                const timeTd = document.createElement("td");
                timeTd.className = "px-6 py-4 whitespace-nowrap text-sm text-gray-500";
                timeTd.textContent = new Date(signal.created_at).toLocaleString();
                tr.appendChild(timeTd);
                // Symbol
                const symbolTd = document.createElement("td");
                symbolTd.className = "px-6 py-4 whitespace-nowrap text-sm text-gray-500";
                symbolTd.textContent = signal.symbol;
                tr.appendChild(symbolTd);
                // Signal
                const signalTd = document.createElement("td");
                signalTd.className = "px-6 py-4 whitespace-nowrap text-sm font-medium";
                if (signal.signal_type.toLowerCase() === "buy") {
                    signalTd.className += " text-green-600";
                    signalTd.innerHTML = '<i class="fas fa-arrow-up mr-1"></i> Buy';
                } else if (signal.signal_type.toLowerCase() === "sell") {
                    signalTd.className += " text-red-600";
                    signalTd.innerHTML = '<i class="fas fa-arrow-down mr-1"></i> Sell';
                } else {
                    signalTd.className += " text-gray-600";
                    signalTd.innerHTML = '<i class="fas fa-pause mr-1"></i> Hold';
                }
                tr.appendChild(signalTd);
                // Price
                const priceTd = document.createElement("td");
                priceTd.className = "px-6 py-4 whitespace-nowrap text-sm text-gray-500";
                priceTd.textContent = `$${signal.price.toFixed(2)}`;
                tr.appendChild(priceTd);
                // Confidence
                const confTd = document.createElement("td");
                confTd.className = "px-6 py-4 whitespace-nowrap text-sm text-gray-500";
                const confDiv = document.createElement("div");
                confDiv.className = "flex items-center";
                const confBar = document.createElement("div");
                confBar.className = "w-16 h-2 bg-gray-200 rounded mr-2";
                const confFill = document.createElement("div");
                confFill.className = "h-2 rounded";
                confFill.style.width = `${signal.confidence_score * 100}%`;
                confFill.style.backgroundColor = signal.confidence_score > 0.7 ? "#10B981" : signal.confidence_score > 0.4 ? "#F59E0B" : "#EF4444";
                confBar.appendChild(confFill);
                confDiv.appendChild(confBar);
                confDiv.appendChild(document.createTextNode(`${Math.round(signal.confidence_score * 100)}%`));
                confTd.appendChild(confDiv);
                tr.appendChild(confTd);
                // Strategy
                const stratTd = document.createElement("td");
                stratTd.className = "px-6 py-4 whitespace-nowrap text-sm text-gray-500";
                const stratPill = document.createElement("span");
                stratPill.className = "px-2 py-1 text-xs rounded-full";
                if (signal.strategy === "trend") {
                    stratPill.className += " bg-purple-100 text-purple-800";
                } else if (signal.strategy === "scalp") {
                    stratPill.className += " bg-blue-100 text-blue-800";
                } else {
                    stratPill.className += " bg-yellow-100 text-yellow-800";
                }
                stratPill.textContent = signal.strategy.charAt(0).toUpperCase() + signal.strategy.slice(1);
                stratTd.appendChild(stratPill);
                tr.appendChild(stratTd);
                // Result
                const resultTd = document.createElement("td");
                resultTd.className = "px-6 py-4 whitespace-nowrap text-sm font-medium";
                resultTd.className += " text-gray-600";
                resultTd.innerHTML = '<i class="fas fa-clock mr-1"></i> Pending';
                tr.appendChild(resultTd);
                tbody.appendChild(tr);
            });
            document.getElementById("history-start").textContent = "1";
            document.getElementById("history-end").textContent = signals.length;
            document.getElementById("history-total").textContent = signals.length;
        }

        function populateTradeHistory(trades) {
            const tbody = document.getElementById("trade-history");
            tbody.innerHTML = "";
            trades.forEach(trade => {
                const tr = document.createElement("tr");
                // Time
                const timeTd = document.createElement("td");
                timeTd.className = "px-6 py-4 whitespace-nowrap text-sm text-gray-500";
                timeTd.textContent = new Date(trade.timestamp).toLocaleString();
                tr.appendChild(timeTd);
                // Symbol
                const symbolTd = document.createElement("td");
                symbolTd.className = "px-6 py-4 whitespace-nowrap text-sm text-gray-500";
                symbolTd.textContent = trade.symbol;
                tr.appendChild(symbolTd);
                // Side
                const sideTd = document.createElement("td");
                sideTd.className = "px-6 py-4 whitespace-nowrap text-sm font-medium";
                if (trade.side.toLowerCase() === "buy") {
                    sideTd.className += " text-green-600";
                    sideTd.innerHTML = '<i class="fas fa-arrow-up mr-1"></i> Buy';
                } else if (trade.side.toLowerCase() === "sell") {
                    sideTd.className += " text-red-600";
                    sideTd.innerHTML = '<i class="fas fa-arrow-down mr-1"></i> Sell';
                } else {
                    sideTd.className += " text-gray-600";
                    sideTd.textContent = trade.side;
                }
                tr.appendChild(sideTd);
                // Quantity
                const quantityTd = document.createElement("td");
                quantityTd.className = "px-6 py-4 whitespace-nowrap text-sm text-gray-500";
                quantityTd.textContent = trade.quantity ? trade.quantity.toFixed(4) : "-";
                tr.appendChild(quantityTd);
                // Entry Price
                const entryPriceTd = document.createElement("td");
                entryPriceTd.className = "px-6 py-4 whitespace-nowrap text-sm text-gray-500";
                entryPriceTd.textContent = trade.price ? `$${trade.price.toFixed(2)}` : "-";
                tr.appendChild(entryPriceTd);
                // Exit Price
                const exitPriceTd = document.createElement("td");
                exitPriceTd.className = "px-6 py-4 whitespace-nowrap text-sm text-gray-500";
                exitPriceTd.textContent = trade.exit_price ? `$${trade.exit_price.toFixed(2)}` : "-";
                tr.appendChild(exitPriceTd);
                // Status
                const statusTd = document.createElement("td");
                statusTd.className = "px-6 py-4 whitespace-nowrap text-sm";
                const statusPill = document.createElement("span");
                statusPill.className = "px-2 py-1 text-xs rounded-full";
                if (trade.status.toLowerCase() === "open") {
                    statusPill.className += " bg-blue-100 text-blue-800";
                } else if (trade.status.toLowerCase() === "closed") {
                    statusPill.className += " bg-green-100 text-green-800";
                } else {
                    statusPill.className += " bg-gray-100 text-gray-800";
                }
                statusPill.textContent = trade.status.charAt(0).toUpperCase() + trade.status.slice(1);
                statusTd.appendChild(statusPill);
                tr.appendChild(statusTd);
                // PnL
                const pnlTd = document.createElement("td");
                pnlTd.className = "px-6 py-4 whitespace-nowrap text-sm font-medium";
                if (trade.realized_pnl) {
                    pnlTd.textContent = `$${trade.realized_pnl.toFixed(2)}`;
                    pnlTd.className += trade.realized_pnl >= 0 ? " text-green-600" : " text-red-600";
                } else {
                    pnlTd.textContent = "-";
                    pnlTd.className += " text-gray-600";
                }
                tr.appendChild(pnlTd);
                tbody.appendChild(tr);
            });
            document.getElementById("trade-history-start").textContent = "1";
            document.getElementById("trade-history-end").textContent = trades.length;
            document.getElementById("trade-history-total").textContent = trades.length;
        }

        function showNotification(message, type = "success") {
            const notification = document.createElement("div");
            notification.className = `fixed bottom-4 right-4 ${type === "success" ? "bg-green-500" : "bg-red-500"} text-white px-4 py-2 rounded-lg shadow-lg flex items-center`;
            notification.innerHTML = `<i class="fas ${type === "success" ? "fa-check-circle" : "fa-exclamation-circle"} mr-2"></i> ${message}`;
            document.body.appendChild(notification);
            setTimeout(() => notification.remove(), 3000);
        }

        document.getElementById("refresh-btn").addEventListener("click", function() {
            this.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Refreshing...';
            requestData();
            setTimeout(() => {
                this.innerHTML = '<i class="fas fa-sync-alt mr-2"></i> Refresh';
                showNotification("Data refreshed successfully");
            }, 1000);
        });

        document.getElementById("symbol-select").addEventListener("change", requestData);

        document.getElementById("close-position-btn").addEventListener("click", function() {
            const modal = document.createElement("div");
            modal.className = "fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50";
            modal.innerHTML = `
                <div class="bg-white rounded-lg p-6 max-w-md w-full">
                    <h3 class="text-lg font-medium mb-4">Close Position</h3>
                    <p class="text-gray-600 mb-6">Are you sure you want to close your current position?</p>
                    <div class="flex justify-end space-x-3">
                        <button id="cancel-close" class="bg-gray-200 hover:bg-gray-300 px-4 py-2 rounded">Cancel</button>
                        <button id="confirm-close" class="bg-red-500 hover:bg-red-600 text-white px-4 py-2 rounded">Close Position</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
            document.getElementById("cancel-close").addEventListener("click", () => modal.remove());
            document.getElementById("confirm-close").addEventListener("click", () => {
                socket.emit("close_position", { symbol: document.getElementById("symbol-select").value });
                modal.remove();
            });
        });

        document.addEventListener("DOMContentLoaded", requestData);
    </script>
</body>
</html>